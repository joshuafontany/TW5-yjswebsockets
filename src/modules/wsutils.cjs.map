{"version":3,"file":"wsutils.cjs","sources":["../../node_modules/y-websocket/bin/callback.js","../../node_modules/y-websocket/bin/utils.js"],"sourcesContent":["const http = require('http')\n\nconst CALLBACK_URL = process.env.CALLBACK_URL ? new URL(process.env.CALLBACK_URL) : null\nconst CALLBACK_TIMEOUT = process.env.CALLBACK_TIMEOUT || 5000\nconst CALLBACK_OBJECTS = process.env.CALLBACK_OBJECTS ? JSON.parse(process.env.CALLBACK_OBJECTS) : {}\n\nexports.isCallbackSet = !!CALLBACK_URL\n\n/**\n * @param {Uint8Array} update\n * @param {any} origin\n * @param {WSSharedDoc} doc\n */\nexports.callbackHandler = (update, origin, doc) => {\n  const room = doc.name\n  const dataToSend = {\n    room: room,\n    data: {}\n  }\n  const sharedObjectList = Object.keys(CALLBACK_OBJECTS)\n  sharedObjectList.forEach(sharedObjectName => {\n    const sharedObjectType = CALLBACK_OBJECTS[sharedObjectName]\n    dataToSend.data[sharedObjectName] = {\n      type: sharedObjectType,\n      content: getContent(sharedObjectName, sharedObjectType, doc).toJSON()\n    }\n  })\n  callbackRequest(CALLBACK_URL, CALLBACK_TIMEOUT, dataToSend)\n}\n\n/**\n * @param {URL} url\n * @param {number} timeout\n * @param {Object} data\n */\nconst callbackRequest = (url, timeout, data) => {\n  data = JSON.stringify(data)\n  const options = {\n    hostname: url.hostname,\n    port: url.port,\n    path: url.pathname,\n    timeout: timeout,\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Content-Length': data.length\n    }\n  }\n  const req = http.request(options)\n  req.on('timeout', () => {\n    console.warn('Callback request timed out.')\n    req.abort()\n  })\n  req.on('error', (e) => {\n    console.error('Callback request error.', e)\n    req.abort()\n  })\n  req.write(data)\n  req.end()\n}\n\n/**\n * @param {string} objName\n * @param {string} objType\n * @param {WSSharedDoc} doc\n */\nconst getContent = (objName, objType, doc) => {\n  switch (objType) {\n    case 'Array': return doc.getArray(objName)\n    case 'Map': return doc.getMap(objName)\n    case 'Text': return doc.getText(objName)\n    case 'XmlFragment': return doc.getXmlFragment(objName)\n    case 'XmlElement': return doc.getXmlElement(objName)\n    default : return {}\n  }\n}\n","const Y = require('yjs')\nconst syncProtocol = require('y-protocols/dist/sync.cjs')\nconst authProtocol = require('y-protocols/dist/auth.cjs')\nconst awarenessProtocol = require('y-protocols/dist/awareness.cjs')\n\nconst encoding = require('lib0/dist/encoding.cjs')\nconst decoding = require('lib0/dist/decoding.cjs')\nconst mutex = require('lib0/dist/mutex.cjs')\nconst map = require('lib0/dist/map.cjs')\n\nconst debounce = require('lodash.debounce')\n\nconst callbackHandler = require('./callback.js').callbackHandler\nconst isCallbackSet = require('./callback.js').isCallbackSet\nconst { sync } = require('fs-extra/lib/remove/rimraf')\n\nconst CALLBACK_DEBOUNCE_WAIT = parseInt(process.env.CALLBACK_DEBOUNCE_WAIT) || 2000\nconst CALLBACK_DEBOUNCE_MAXWAIT = parseInt(process.env.CALLBACK_DEBOUNCE_MAXWAIT) || 10000\n\nconst wsReadyStateConnecting = 0\nconst wsReadyStateOpen = 1\nconst wsReadyStateClosing = 2 // eslint-disable-line\nconst wsReadyStateClosed = 3 // eslint-disable-line\n\n// disable gc when using snapshots!\nconst gcEnabled = process.env.GC !== 'false' && process.env.GC !== '0'\nconst persistenceDir = process.env.YPERSISTENCE\n/**\n * @type {{bindState: function(string,WSSharedDoc):void, writeState:function(string,WSSharedDoc):Promise<any>, provider: any}|null}\n */\nlet persistence = null\nif (typeof persistenceDir === 'string') {\n  console.info('Persisting documents to \"' + persistenceDir + '\"')\n  // @ts-ignore\n  const LeveldbPersistence = require('y-leveldb').LeveldbPersistence\n  const ldb = new LeveldbPersistence(persistenceDir)\n  persistence = {\n    provider: ldb,\n    bindState: async (docName, ydoc) => {\n      const persistedYdoc = await ldb.getYDoc(docName)\n      const newUpdates = Y.encodeStateAsUpdate(ydoc)\n      ldb.storeUpdate(docName, newUpdates)\n      Y.applyUpdate(ydoc, Y.encodeStateAsUpdate(persistedYdoc))\n      ydoc.on('update', update => {\n        ldb.storeUpdate(docName, update)\n      })\n      ydoc.emit('load',[])\n    },\n    writeState: async (docName, ydoc) => {}\n  }\n}\n\n/**\n * @param {{bindState: function(string,WSSharedDoc):void,\n * writeState:function(string,WSSharedDoc):Promise<any>,provider:any}|null} persistence_\n */\nexports.setPersistence = persistence_ => {\n  persistence = persistence_\n}\n\n/**\n * @return {null|{bindState: function(string,WSSharedDoc):void,\n  * writeState:function(string,WSSharedDoc):Promise<any>}|null} used persistence layer\n  */\nexports.getPersistence = () => persistence\n\n// You may check/set permissions of the user here. Set the conn.isReadOnly and conn.authStatus then return a boolean.\n// Set opts.authorize: true when emitting the connection to enable pre-sync auth.\n/**\n * @param {any} y // Y.Doc / WSSharedDoc\n * @param {string} token // provider.authToken\n */\nlet authorize = (doc, conn, token) => {\n  // This example sets conn.isReadOnly to false and conn.authorized to true\n  conn.isReadyOnly = false\n  conn.authorized = true\n  // You can set conn.authStatus to a denied reason and conn.authorized to false\n  // if (doc.name !== token) {\n  //    conn.authStatus = \"403 Forbidden\" //Auto-terminates the websocket provider\n  //    conn.authorized = false\n  // }\n}\n\n/**\n * @param {function(WSSharedDoc,string):boolean} authorize_\n */\nexports.setAuthorize = authorize_ => {\n  authorize = authorize_\n}\n\n/**\n * @return {function(WSSharedDoc,string):boolean} used persistence layer\n  */\nexports.getAuthorize = () => authorize\n\n\n/**\n * @type {Map<string,WSSharedDoc>}\n */\nconst docs = new Map()\n// exporting docs so that others can use it\nexports.docs = docs\n\nconst messageSync = 0\nconst messageAwareness = 1\nconst messageAuth = 2\n\n/**\n * @param {Uint8Array} update\n * @param {any} origin\n * @param {WSSharedDoc} doc\n */\nconst updateHandler = (update, origin, doc) => {\n  const encoder = encoding.createEncoder()\n  encoding.writeVarUint(encoder, messageSync)\n  syncProtocol.writeUpdate(encoder, update)\n  const message = encoding.toUint8Array(encoder)\n  doc.conns.forEach((_, conn) => send(doc, conn, message))\n}\n\nclass WSSharedDoc extends Y.Doc {\n  /**\n   * @param {string} name\n   */\n  constructor (name) {\n    super({ gc: gcEnabled })\n    this.name = name\n    this.mux = mutex.createMutex()\n    /**\n     * Maps from conn to set of controlled user ids. Delete all user ids from awareness when this conn is closed\n     * @type {Map<Object, Set<number>>}\n     */\n    this.conns = new Map()\n    /**\n     * @type {awarenessProtocol.Awareness}\n     */\n    this.awareness = new awarenessProtocol.Awareness(this)\n    this.awareness.setLocalState(null)\n    /**\n     * @param {{ added: Array<number>, updated: Array<number>, removed: Array<number> }} changes\n     * @param {Object | null} conn Origin is the connection that made the change\n     */\n    const awarenessChangeHandler = ({ added, updated, removed }, conn) => {\n      const changedClients = added.concat(updated, removed)\n      if (conn !== null) {\n        const connControlledIDs = /** @type {Set<number>} */ (this.conns.get(conn))\n        if (connControlledIDs !== undefined) {\n          added.forEach(clientID => { connControlledIDs.add(clientID) })\n          removed.forEach(clientID => { connControlledIDs.delete(clientID) })\n        }\n      }\n      // broadcast awareness update\n      const encoder = encoding.createEncoder()\n      encoding.writeVarUint(encoder, messageAwareness)\n      encoding.writeVarUint8Array(encoder, awarenessProtocol.encodeAwarenessUpdate(this.awareness, changedClients))\n      const buff = encoding.toUint8Array(encoder)\n      this.conns.forEach((_, c) => {\n        send(this, c, buff)\n      })\n    }\n    this.awareness.on('update', awarenessChangeHandler)\n    this.on('update', updateHandler)\n    if (isCallbackSet) {\n      this.on('update', debounce(\n        callbackHandler,\n        CALLBACK_DEBOUNCE_WAIT,\n        { maxWait: CALLBACK_DEBOUNCE_MAXWAIT }\n      ))\n    }\n  }\n}\n\n/**\n * Gets a Y.Doc by name, whether in memory or on disk\n *\n * @param {string} docname - the name of the Y.Doc to find or create\n * @param {boolean} gc - whether to allow gc on the doc (applies only when created)\n * @return {WSSharedDoc}\n */\nconst getYDoc = (docname, gc = true) => map.setIfUndefined(docs, docname, () => {\n  const doc = new WSSharedDoc(docname)\n  doc.gc = gc\n  if (persistence !== null) {\n    persistence.bindState(docname, doc)\n  }\n  docs.set(docname, doc)\n  return doc\n})\n\nexports.getYDoc = getYDoc\n\n/**\n * @param {any} conn\n * @param {WSSharedDoc} doc\n * @param {Uint8Array} message\n */\nconst messageListener = (conn, doc, message) => {\n  try {\n    const encoder = encoding.createEncoder()\n    const decoder = decoding.createDecoder(message)\n    const messageType = decoding.readVarUint(decoder)\n    switch (messageType) {\n      case messageSync:\n        encoding.writeVarUint(encoder, messageSync)\n        syncProtocol.readSyncMessage(decoder, encoder, doc, conn)\n        if (encoding.length(encoder) > 1) {\n          send(doc, conn, encoding.toUint8Array(encoder))\n        }\n        break\n      case messageAwareness: {\n        awarenessProtocol.applyAwarenessUpdate(doc.awareness, decoding.readVarUint8Array(decoder), conn)\n        break\n      }\n      case messageAuth: {\n        encoding.writeVarUint(encoder, messageAuth)\n        authProtocol.verifyAuthMessage(decoder, doc, conn, authorize)\n        if (conn.authorized) {\n          authProtocol.writePermissionApproved(encoder, conn.authStatus)\n          send(doc, conn, encoding.toUint8Array(encoder))\n          sendSync(doc, conn)\n        } else {\n          authProtocol.writePermissionDenied(encoder, conn.authStatus)\n          conn.terminate()\n        }\n        break\n      }\n    }\n  } catch (err) {\n    console.error(err)\n    doc.emit('error', [err])\n  }\n}\n\n/**\n * @param {WSSharedDoc} doc\n * @param {any} conn\n */\nconst closeConn = (doc, conn) => {\n  if (doc.conns.has(conn)) {\n    /**\n     * @type {Set<number>}\n     */\n    // @ts-ignore\n    const controlledIds = doc.conns.get(conn)\n    doc.conns.delete(conn)\n    awarenessProtocol.removeAwarenessStates(doc.awareness, Array.from(controlledIds), null)\n    if (doc.conns.size === 0 && persistence !== null) {\n      // if persisted, we store state and destroy ydocument\n      persistence.writeState(doc.name, doc).then(() => {\n        doc.destroy()\n      })\n      docs.delete(doc.name)\n    }\n  }\n  conn.close()\n}\n\n/**\n * @param {WSSharedDoc} doc\n * @param {any} conn\n * @param {Uint8Array} m\n */\nconst send = (doc, conn, m) => {\n  if (conn.readyState !== wsReadyStateConnecting && conn.readyState !== wsReadyStateOpen) {\n    closeConn(doc, conn)\n  }\n  try {\n    conn.send(m, /** @param {any} err */ err => { err != null && closeConn(doc, conn) })\n  } catch (e) {\n    closeConn(doc, conn)\n  }\n}\n\n/**\n * @param {WSSharedDoc} doc\n * @param {any} conn\n */\nconst sendSync = (doc, conn) =>{\n  // send sync step 1\n  const encoder = encoding.createEncoder()\n  encoding.writeVarUint(encoder, messageSync)\n  syncProtocol.writeSyncStep1(encoder, doc)\n  send(doc, conn, encoding.toUint8Array(encoder))\n  const awarenessStates = doc.awareness.getStates()\n  if (awarenessStates.size > 0) {\n    const encoder = encoding.createEncoder()\n    encoding.writeVarUint(encoder, messageAwareness)\n    encoding.writeVarUint8Array(encoder, awarenessProtocol.encodeAwarenessUpdate(doc.awareness, Array.from(awarenessStates.keys())))\n    send(doc, conn, encoding.toUint8Array(encoder))\n  }\n}\n\nconst pingTimeout = 30000\n\n/**\n * @param {any} conn\n * @param {any} req\n * @param {any} opts\n */\nexports.setupWSConnection = (conn, req, { docName = req.url.slice(1).split('?')[0], gc = true, authorize = false, authStatus = \"\" } = {}) => {\n  conn.authorized = !authorize\n  conn.authStatus = authStatus\n  conn.isReadOnly = false\n  conn.binaryType = 'arraybuffer'\n  // get doc, initialize if it does not exist yet\n  const doc = getYDoc(docName, gc)\n  doc.conns.set(conn, new Set())\n  // listen and reply to events\n  conn.on('message', /** @param {ArrayBuffer} message */ message => messageListener(conn, doc, new Uint8Array(message)))\n\n  // Check if connection is still alive\n  let pongReceived = true\n  const pingInterval = setInterval(() => {\n    if (!pongReceived) {\n      if (doc.conns.has(conn)) {\n        closeConn(doc, conn)\n      }\n      clearInterval(pingInterval)\n    } else if (doc.conns.has(conn)) {\n      pongReceived = false\n      try {\n        conn.ping()\n      } catch (e) {\n        closeConn(doc, conn)\n        clearInterval(pingInterval)\n      }\n    }\n  }, pingTimeout)\n  conn.on('close', () => {\n    closeConn(doc, conn)\n    clearInterval(pingInterval)\n  })\n  conn.on('pong', () => {\n    pongReceived = true\n  })\n  // If pre-authorized then sync, else wait for the auth handshake\n  if(conn.authorized){\n    sendSync(doc, conn)\n  }\n}\n"],"names":["http","require$$0","require$$2","Y","encoding","syncProtocol","mutex","awarenessProtocol","debounce","map","decoding","authProtocol"],"mappings":"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"}